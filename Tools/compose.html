<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Music Composer</title>
  <script src="https://unpkg.com/tone"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    #composition span {
      margin-right: 5px;
      cursor: pointer;
      padding: 2px 4px;
      border-radius: 3px;
      background-color: #f0f0f0;
    }
    #composition span:hover {
      text-decoration: line-through;
      color: red;
      background-color: #ffe0e0;
    }
    #composition {
  display: flex;
  flex-wrap: wrap; /* allow notes to wrap to next line */
  gap: 5px; /* space between notes */
}
  #container{
    display: none;
  }

  

  @media screen and (max-width: 800px){
    .btn-sm {
      font-size: 0.8rem;
  padding: 0.15rem 0.5rem; 
  min-width: 30px; 
  margin: 3.2px 1.2px;
    }
    
  }
  .sharp {
      font-size: 0.5rem;
      padding: 0.3rem 0.15rem;
    }

    @media screen and (min-width:362px) and (max-width: 470px){
    .btn-sm {
      font-size: 0.9rem;
  padding: 0.15rem 0.7rem; 
  min-width: 30px; 
  margin: 3.2px 1.5px;
    }
  }

  @media screen and (min-width:471px) and (max-width: 580px){
    .btn-sm {
      font-size: 1rem;
  padding: 0.15rem 0.7rem; 
  min-width: 30px; 
  margin: 3.2px 1.5px;
    }
  }

    @media screen and (min-width: 800px) {

      .btn-sm {
      font-size: 1rem;
  padding: 0.5rem 0.8rem; 
  min-width: 50px; 
  margin: 5px 5px;
    }

    }

  </style>
</head>
<body class="p-3">
  <div id="container" style="max-width: 800px; margin: 20vw auto auto auto;">
    <a href="https://www.cstudio-go.com/main.html" class="btn btn-secondary" style="margin-bottom: 10px; text-align: right;">回到網站</a>
  <h2 class="mb-3 bg-primary text-white">&nbsp;音樂主題製作</h2>

  <!-- Note Buttons -->
  <div id="noteButtons" class="mb-3">
    <span style="white-space: nowrap;">
    <button class="btn btn-sm btn-dark disabled" style="width: 30px">♩</button>
    <button class="btn btn-sm btn-outline-primary" data-note="C4" data-duration="4n">C4</button>
    <button class="btn btn-sm btn-outline-primary sharp" data-note="C#4" data-duration="4n">C#</button>
    <button class="btn btn-sm btn-outline-primary" data-note="D4" data-duration="4n">D4</button>
    <button class="btn btn-sm btn-outline-primary sharp" data-note="D#4" data-duration="4n">D#</button>
    <button class="btn btn-sm btn-outline-primary" data-note="E4" data-duration="4n">E4</button>
    <button class="btn btn-sm btn-outline-primary" data-note="F4" data-duration="4n">F4</button>
    </span>
    <span style="white-space: nowrap;">
    <button class="btn btn-sm btn-outline-primary sharp" data-note="F#4" data-duration="4n">F#</button>
    <button class="btn btn-sm btn-outline-primary" data-note="G4" data-duration="4n">G4</button>
    <button class="btn btn-sm btn-outline-primary sharp" data-note="G#4" data-duration="4n">G#</button>
    <button class="btn btn-sm btn-outline-primary" data-note="A4" data-duration="4n">A4</button>
    <button class="btn btn-sm btn-outline-primary sharp" data-note="A#4" data-duration="4n">A#</button>
    <button class="btn btn-sm btn-outline-primary" data-note="B4" data-duration="4n">B4</button>
    <button class="btn btn-sm btn-outline-primary" data-note="C5" data-duration="4n">C5</button>
    </span>
    <br>
    <div style="margin: 2px auto;">
    <span style="white-space: nowrap;">
    <button class="btn btn-sm btn-dark disabled" style="width: 30px">♪</button>
    <button class="btn btn-sm btn-outline-info" data-note="C4" data-duration="8n">C4</button>
    <button class="btn btn-sm btn-outline-info sharp" data-note="C#4" data-duration="8n">C#</button>
    <button class="btn btn-sm btn-outline-info" data-note="D4" data-duration="8n">D4</button>
    <button class="btn btn-sm btn-outline-info sharp" data-note="D#4" data-duration="8n">D#</button>
    <button class="btn btn-sm btn-outline-info" data-note="E4" data-duration="8n">E4</button>
    <button class="btn btn-sm btn-outline-info" data-note="F4" data-duration="8n">F4</button>
    </span>
    <span style="white-space: nowrap;">
    <button class="btn btn-sm btn-outline-info sharp" data-note="F#4" data-duration="8n">F#</button>
    <button class="btn btn-sm btn-outline-info" data-note="G4" data-duration="8n">G4</button>
    <button class="btn btn-sm btn-outline-info sharp" data-note="G#4" data-duration="8n">G#</button>
    <button class="btn btn-sm btn-outline-info" data-note="A4" data-duration="8n">A4</button>
    <button class="btn btn-sm btn-outline-info sharp" data-note="A#4" data-duration="8n">A#</button>
    <button class="btn btn-sm btn-outline-info" data-note="B4" data-duration="8n">B4</button>
    <button class="btn btn-sm btn-outline-info" data-note="C5" data-duration="8n">C5</button>
    </span>
    <br>
    </div>
    <span style="white-space: nowrap;">
    <button class="btn btn-sm btn-dark disabled" style="width: 30px">♬</button>
    <button class="btn btn-sm btn-outline-danger" data-note="C4" data-duration="16n">C4</button>
    <button class="btn btn-sm btn-outline-danger sharp" data-note="C#4" data-duration="16n">C#</button>
    <button class="btn btn-sm btn-outline-danger" data-note="D4" data-duration="16n">D4</button>
    <button class="btn btn-sm btn-outline-danger sharp" data-note="D#4" data-duration="16n">D#</button>
    <button class="btn btn-sm btn-outline-danger" data-note="E4" data-duration="16n">E4</button>
    <button class="btn btn-sm btn-outline-danger" data-note="F4" data-duration="16n">F4</button>
    </span>
    <span style="white-space: nowrap;">
    <button class="btn btn-sm btn-outline-danger sharp" data-note="F#4" data-duration="16n">F#</button>
    <button class="btn btn-sm btn-outline-danger" data-note="G4" data-duration="16n">G4</button>
    <button class="btn btn-sm btn-outline-danger sharp" data-note="G#4" data-duration="16n">G#</button>
    <button class="btn btn-sm btn-outline-danger" data-note="A4" data-duration="16n">A4</button>
    <button class="btn btn-sm btn-outline-danger sharp" data-note="A#4" data-duration="16n">A#</button>
    <button class="btn btn-sm btn-outline-danger" data-note="B4" data-duration="16n">B4</button>
    <button class="btn btn-sm btn-outline-danger" data-note="C5" data-duration="16n">C5</button>
    </span>
    <br>
    <div style="margin-top: 2px;">
    <button class="btn btn-sm btn-outline-secondary" data-note="rest" data-duration="4n" style="width: 90px">4分休止</button>
    <button class="btn btn-sm btn-outline-secondary" data-note="rest" data-duration="8n" style="width: 90px">8分休止</button>
    <button class="btn btn-sm btn-outline-secondary" data-note="rest" data-duration="16n" style="width: 90px">16分休止</button>
    </div>
  </div>

  <!-- Composition Display -->
  <div id="composition" class="mb-3 p-2 border" style="min-height: 50px;"></div>

  <!-- Control Buttons -->
  <button id="playComposition" class="btn btn-success me-2">播放作品</button>
  <button id="undoLast" class="btn btn-warning me-2">反悔</button>
  <button id="clearComposition" class="btn btn-danger">清除</button>
</div>
  <script>
    const synth = new Tone.Synth({
      oscillator: { type: "sine" },
      envelope: { attack: 0.1, decay: 0.2, sustain: 0.5, release: 1 }
    }).toDestination();

    let composition = [];

    // Add note
    document.querySelectorAll("#noteButtons button").forEach(btn => {
      btn.addEventListener("click", () => {
        const note = btn.dataset.note;
        const duration = btn.dataset.duration;
        composition.push({ note: note === "rest" ? null : note, duration });
        updateDisplay();
      });
    });

    // Clear composition
    document.getElementById("clearComposition").addEventListener("click", () => {
      composition = [];
      updateDisplay();
    });

     // Undo last note
  document.getElementById("undoLast").addEventListener("click", () => {
    composition.pop();
    updateDisplay();
  });

    // Update display
    function updateDisplay() {
      const div = document.getElementById("composition");
      div.innerHTML = ""; // Clear everything first
      composition.forEach((item, index) => {
        const span = document.createElement("span");
        span.textContent = item.note ? `${item.note}:${item.duration}` : `Rest:${item.duration}`;
        span.title = "Click to remove this note";
        // Remove note on click
        span.addEventListener("click", () => {
          composition.splice(index, 1);
          updateDisplay();
        });
        div.appendChild(span);
      });
    }

    // Play composition
    document.getElementById("playComposition").addEventListener("click", async () => {
      await Tone.start();
      let time = Tone.now();
      const tempo = 120;
      const beat = 60 / tempo;

      composition.forEach(item => {
        let durationInSeconds = beat;
        if (item.duration === "8n") durationInSeconds = beat / 2;
        else if (item.duration === "16n") durationInSeconds = beat / 4;
        else if (item.duration === "qt") durationInSeconds = beat / 3;

        if (item.note) synth.triggerAttackRelease(item.note, durationInSeconds, time);
        time += durationInSeconds;
      });
    });
  </script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
  $('#container').fadeIn(2000);
          </script>

</body>
</html>